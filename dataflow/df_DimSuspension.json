{
	"name": "df_DimSuspension",
	"properties": {
		"folder": {
			"name": "Final df POCs"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "CodeTables",
						"type": "DatasetReference"
					},
					"name": "vwCodeTables"
				},
				{
					"dataset": {
						"referenceName": "SDSuspension",
						"type": "DatasetReference"
					},
					"name": "srcSuspension"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "POIProgram"
				},
				{
					"name": "SDSuspensionReason"
				},
				{
					"name": "SelectSrcColumns"
				},
				{
					"name": "drvTrimColumns"
				},
				{
					"name": "lookup1"
				},
				{
					"name": "select1"
				},
				{
					"name": "lookup2"
				},
				{
					"name": "select2"
				}
			],
			"scriptLines": [
				"source(output(",
				"          TABLENAME as string,",
				"          CODE as string,",
				"          DESCRIPTION as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> vwCodeTables",
				"source(output(",
				"          SDSUSPENSIONID as long,",
				"          COMMENTS as string,",
				"          CONCERNROLEID as long,",
				"          CREATEDBY as string,",
				"          ENDDATE as date,",
				"          STARTDATE as date,",
				"          STATUSCODE as string,",
				"          REASON as string,",
				"          PROGRAM as string,",
				"          CASEID as long,",
				"          LASTWRITTEN as timestamp",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> srcSuspension",
				"vwCodeTables filter(TABLENAME=='POIProgram') ~> POIProgram",
				"vwCodeTables filter(TABLENAME=='SDSuspensionReason') ~> SDSuspensionReason",
				"srcSuspension select(mapColumn(",
				"          SDSUSPENSIONID,",
				"          ENDDATE,",
				"          STARTDATE,",
				"          STATUSCODE,",
				"          REASON,",
				"          PROGRAM",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> SelectSrcColumns",
				"SelectSrcColumns derive(each(match(type=='string'), $$+'_Trim_Null' = iifNull(trim($$),'NA')),",
				"          ModifedDate = currentUTC()) ~> drvTrimColumns",
				"drvTrimColumns, POIProgram lookup(REASON_Trim_Null == CODE,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     broadcast: 'auto')~> lookup1",
				"lookup1 select(mapColumn(",
				"          SDSUSPENSIONID,",
				"          ENDDATE,",
				"          STARTDATE,",
				"          STATUSCODE,",
				"          STATUSCODE_Trim_Null,",
				"          PROGRAM_Trim_Null,",
				"          ModifedDate,",
				"          ReasonDescriptoin = DESCRIPTION",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"select1, SDSuspensionReason lookup(PROGRAM_Trim_Null == CODE,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     broadcast: 'auto')~> lookup2",
				"lookup2 select(mapColumn(",
				"          SDSUSPENSIONID,",
				"          ENDDATE,",
				"          STARTDATE,",
				"          STATUSCODE_Trim_Null,",
				"          ModifedDate,",
				"          ReasonDescriptoin,",
				"          ProgramTypeDescription = DESCRIPTION",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select2"
			]
		}
	}
}