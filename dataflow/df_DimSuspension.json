{
	"name": "df_DimSuspension",
	"properties": {
		"folder": {
			"name": "Dimensions"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "CodeTables",
						"type": "DatasetReference"
					},
					"name": "vwCodeTables"
				},
				{
					"dataset": {
						"referenceName": "SDSuspension",
						"type": "DatasetReference"
					},
					"name": "srcSuspension"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DimensionTargetTesting",
						"type": "DatasetReference"
					},
					"name": "tgtDimSuspension"
				}
			],
			"transformations": [
				{
					"name": "POIProgram"
				},
				{
					"name": "SDSuspensionReason"
				},
				{
					"name": "SelectSrcColumns"
				},
				{
					"name": "drvTrimColumns"
				},
				{
					"name": "LookupReason"
				},
				{
					"name": "SelectReason"
				},
				{
					"name": "LookupProgram"
				},
				{
					"name": "SelectProgram"
				},
				{
					"name": "derivedColumn1"
				}
			],
			"scriptLines": [
				"source(output(",
				"          TABLENAME as string,",
				"          CODE as string,",
				"          DESCRIPTION as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> vwCodeTables",
				"source(output(",
				"          SDSUSPENSIONID as long,",
				"          COMMENTS as string,",
				"          CONCERNROLEID as long,",
				"          CREATEDBY as string,",
				"          ENDDATE as date,",
				"          STARTDATE as date,",
				"          STATUSCODE as string,",
				"          REASON as string,",
				"          PROGRAM as string,",
				"          CASEID as long,",
				"          LASTWRITTEN as timestamp",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> srcSuspension",
				"vwCodeTables filter(TABLENAME=='POIProgram') ~> POIProgram",
				"vwCodeTables filter(TABLENAME=='SDSuspensionReason') ~> SDSuspensionReason",
				"srcSuspension select(mapColumn(",
				"          SDSUSPENSIONID,",
				"          ENDDATE,",
				"          STARTDATE,",
				"          STATUSCODE,",
				"          REASON,",
				"          PROGRAM",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> SelectSrcColumns",
				"SelectSrcColumns derive(each(match(type=='string'), $$+'_Trim_Null' = iifNull(trim($$),'NA')),",
				"          ModifedDate = currentUTC()) ~> drvTrimColumns",
				"drvTrimColumns, POIProgram lookup(REASON_Trim_Null == CODE,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     broadcast: 'auto')~> LookupReason",
				"LookupReason select(mapColumn(",
				"          SDSUSPENSIONID,",
				"          ENDDATE,",
				"          STARTDATE,",
				"          STATUSCODE,",
				"          STATUSCODE_Trim_Null,",
				"          PROGRAM_Trim_Null,",
				"          ModifedDate,",
				"          ReasonDescriptoin = DESCRIPTION",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> SelectReason",
				"SelectReason, SDSuspensionReason lookup(PROGRAM_Trim_Null == CODE,",
				"     multiple: false,",
				"     pickup: 'any',",
				"     broadcast: 'auto')~> LookupProgram",
				"LookupProgram select(mapColumn(",
				"          SDSUSPENSIONID,",
				"          ENDDATE,",
				"          STARTDATE,",
				"          STATUSCODE_Trim_Null,",
				"          ModifedDate,",
				"          ReasonDescriptoin,",
				"          ProgramTypeDescription = DESCRIPTION",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> SelectProgram",
				"SelectProgram derive(each(match(type=='string'), $$+'_null' = iifNull($$,'NA'))) ~> derivedColumn1",
				"derivedColumn1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          Column_1 as string,",
				"          Column_2 as string,",
				"          Column_3 as string,",
				"          Column_4 as string,",
				"          Column_5 as string,",
				"          Column_6 as string",
				"     ),",
				"     partitionFileNames:['DimSuspension'],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     partitionBy('hash', 1)) ~> tgtDimSuspension"
			]
		}
	}
}